<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Regulatory News Dashboard</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f7f9fb; }
h1 { color: #2c3e50; }
button { padding: 8px 12px; margin: 5px; cursor: pointer; border: none; background: #2c3e50; color: white; border-radius: 4px; }
button:hover { background: #34495e; }
.section { margin-bottom: 15px; }
.content { display: none; margin-top: 8px; padding-left: 10px; border-left: 3px solid #2c3e50; }
.filter { margin-bottom: 15px; }
.news-item { background: #fff; padding: 8px; margin-bottom: 5px; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);}
</style>
</head>
<body>

<h1>Regulatory News Dashboard</h1>

<div class="filter">
<label for="agencySelect">Filter by Agency:</label>
<select id="agencySelect">
  <option value="all">All Agencies</option>
</select>
</div>

<div id="dashboard"></div>

<script>
const agencies = [
  "FCA",
  "HMRC",
  "DWP",
  "OFCOM",
  "FATF",
  "Trading Standards",
  "National Trading Standards"
];

let allNews = [];

// Load JSON for each agency
async function loadNews() {
  for (const agency of agencies) {
    try {
      const file = agency.replace(/ /g, "_") + ".json"; // converts "Trading Standards" â†’ "Trading_Standards.json"
      const response = await fetch(file);
      const data = await response.json();
      allNews.push({ agency, items: data });
    } catch (error) {
      console.log("No JSON found for", agency);
    }
  }

  populateFilter();
  renderDashboard();
}

function populateFilter() {
  const select = document.getElementById("agencySelect");
  agencies.forEach(a => {
    const option = document.createElement("option");
    option.value = a;
    option.textContent = a;
    select.appendChild(option);
  });
}

function renderDashboard(filterAgency = "all") {
  const container = document.getElementById("dashboard");
  container.innerHTML = "";

  allNews.forEach(entry => {
    if (filterAgency !== "all" && entry.agency !== filterAgency) return;

    const section = document.createElement("div");
    section.className = "section";

    const btn = document.createElement("button");
    btn.textContent = entry.agency;
    btn.onclick = () => {
      const contentDiv = section.querySelector(".content");
      contentDiv.style.display = contentDiv.style.display === "block" ? "none" : "block";
    };

    const content = document.createElement("div");
    content.className = "content";

    if (entry.items.length === 0) {
      content.innerHTML = "<p>No updates available.</p>";
    } else {
      entry.items.forEach(item => {
        const newsDiv = document.createElement("div");
        newsDiv.className = "news-item";
        newsDiv.innerHTML = `
          <strong>${item.title}</strong><br>
          Date: ${item.date}<br>
          <a href="${item.link}" target="_blank">Read more</a>
        `;
        content.appendChild(newsDiv);
      });
    }

    section.appendChild(btn);
    section.appendChild(content);
    container.appendChild(section);
  });
}

document.getElementById("agencySelect").addEventListener("change", (e) => {
  renderDashboard(e.target.value);
});

loadNews();
</script>

</body>
</html>
